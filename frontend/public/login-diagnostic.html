<!DOCTYPE html>
<html>
<head>
  <title>Quick Login Test</title>
  <style>
    * { font-family: Arial, sans-serif; }
    body { max-width: 800px; margin: 20px auto; }
    .box { border: 2px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
    .success { background-color: #d4edda; border-color: #28a745; color: #155724; }
    .error { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
    .info { background-color: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
    button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; cursor: pointer; border-radius: 3px; }
    button:hover { background: #0056b3; }
    pre { background: #f5f5f5; padding: 10px; overflow-x: auto; border-radius: 3px; }
  </style>
</head>
<body>
  <h1>üîê Parkir Plus - Quick Login Diagnostic</h1>

  <div class="box info">
    <h3>Instructions</h3>
    <p>1. Click "Test Backend Login" to verify API response</p>
    <p>2. Click "Test Frontend State" to check auth store</p>
    <p>3. Use form to test frontend login</p>
  </div>

  <div class="box">
    <h3>Test Backend API</h3>
    <button onclick="testBackend()">Test Backend Login (admin/admin123)</button>
    <div id="backend-result"></div>
  </div>

  <div class="box">
    <h3>Test Frontend Auth Store</h3>
    <button onclick="testAuthStore()">Check Auth Store</button>
    <button onclick="clearAuthStore()">Clear Auth Store</button>
    <div id="store-result"></div>
  </div>

  <div class="box">
    <h3>Manual Login Form</h3>
    <input type="text" id="username" placeholder="Username" value="admin">
    <input type="password" id="password" placeholder="Password" value="admin123">
    <button onclick="testFrontendLogin()">Test Frontend Login</button>
    <div id="frontend-result"></div>
  </div>

  <script>
    const API_URL = 'http://localhost:5001/api/v1';

    function showResult(elementId, title, data, isError = false) {
      const el = document.getElementById(elementId);
      const className = isError ? 'error' : 'success';
      el.innerHTML = `
        <div class="${className} box" style="margin-top: 10px;">
          <h4>${title}</h4>
          <pre>${JSON.stringify(data, null, 2)}</pre>
        </div>
      `;
    }

    function showError(elementId, title, error) {
      const el = document.getElementById(elementId);
      el.innerHTML = `
        <div class="error box" style="margin-top: 10px;">
          <h4>${title}</h4>
          <pre>${error.message || JSON.stringify(error, null, 2)}</pre>
        </div>
      `;
    }

    async function testBackend() {
      const resultDiv = document.getElementById('backend-result');
      resultDiv.innerHTML = '<p>Testing...</p>';
      
      try {
        const response = await fetch(`${API_URL}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username: 'admin', password: 'admin123' }),
        });

        const data = await response.json();

        if (response.ok) {
          showResult('backend-result', '‚úÖ Backend Login Success', data);
        } else {
          showError('backend-result', '‚ùå Backend Login Failed', data);
        }
      } catch (error) {
        showError('backend-result', '‚ùå Backend Request Error', error);
      }
    }

    function testAuthStore() {
      try {
        const stored = localStorage.getItem('auth-storage');
        if (stored) {
          const parsed = JSON.parse(stored);
          showResult('store-result', '‚úÖ Auth Store Found', parsed);
        } else {
          showResult('store-result', '‚ö†Ô∏è  Auth Store Empty', { message: 'No auth data in localStorage' });
        }
      } catch (error) {
        showError('store-result', '‚ùå Error Reading Auth Store', error);
      }
    }

    function clearAuthStore() {
      localStorage.removeItem('auth-storage');
      document.getElementById('store-result').innerHTML = '<div class="info box">Auth store cleared!</div>';
    }

    async function testFrontendLogin() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const resultDiv = document.getElementById('frontend-result');
      resultDiv.innerHTML = '<p>Testing...</p>';

      try {
        // Test with axios-like approach
        const response = await fetch(`${API_URL}/auth/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ username, password }),
        });

        const data = await response.json();

        if (response.ok && data.success) {
          showResult('frontend-result', '‚úÖ Frontend Login Success', data.data);
          
          // Save to localStorage like frontend would
          const authData = {
            state: {
              user: data.data.user,
              token: data.data.token,
              isAuthenticated: true,
              isLoading: false,
              error: null,
            }
          };
          localStorage.setItem('auth-storage', JSON.stringify(authData));
          
          // Redirect after 2 seconds
          setTimeout(() => {
            window.location.href = '/dashboard';
          }, 2000);
        } else {
          showError('frontend-result', '‚ùå Frontend Login Failed', data);
        }
      } catch (error) {
        showError('frontend-result', '‚ùå Frontend Login Error', error);
      }
    }
  </script>
</body>
</html>
